#!/usr/bin/env python3
import sqlite3
DB_PATH = "badfiles.db"
CSV_PATH = "malwarebazaar.csv"
def reset_table(cur):
   cur.execute("DROP TABLE IF EXISTS malwarebazaar")
   cur.execute("""
       CREATE TABLE malwarebazaar (
           sha256 TEXT PRIMARY KEY,
           file_name TEXT,
           signature TEXT,
           vtpercent TEXT,
           imphash TEXT,
           ssdeep TEXT,
           tlsh TEXT
       )
   """)
def import_csv(cur):
   inserted = 0
   with open(CSV_PATH, "r", encoding="utf-8", errors="ignore") as f:
       for line in f:
           if line.startswith("#"):
               continue
           parts = [p.strip().strip('"') for p in line.strip().split(",")]
           if len(parts) < 14:
               continue
           sha256 = parts[1]
           file_name = parts[5]
           signature = parts[8]
           vtpercent = parts[10]
           imphash = parts[11]
           ssdeep = parts[12]
           tlsh = parts[13]
           if not sha256:
               continue
           cur.execute("""
               INSERT OR IGNORE INTO malwarebazaar
               (sha256, file_name, signature, vtpercent, imphash, ssdeep, tlsh)
               VALUES (?, ?, ?, ?, ?, ?, ?)
           """, (sha256, file_name, signature, vtpercent, imphash, ssdeep, tlsh))
           inserted += 1
   print(f"âœ… Import done: {inserted} entries added.")
def main():
   conn = sqlite3.connect(DB_PATH)
   cur = conn.cursor()
   reset_table(cur)
   import_csv(cur)
   conn.commit()
   conn.close()
if __name__ == "__main__":
   main()
